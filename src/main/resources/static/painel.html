<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Principal - Sistema de Chamados</title>

    <!-- CSS Global -->
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />

    <!-- √çcones -->
    <link rel="stylesheet" href="https://unpkg.com/feather-icons/dist/feather.css">

    <style>
        /* Painel atualizado mantendo seu estilo */

        body {
          background: linear-gradient(160deg, #1e1e2f 0%, #181824 100%);
          color: #f5f5f5;
          font-family: 'Poppins', sans-serif;
          margin: 0;
          padding: 0;
        }

        main {
          flex: 1;
          width: 100%;
          padding: 6rem 1rem 5rem 1rem;
          display: flex;
          justify-content: center;
        }

        .container {
          background-color: #2c2c3c;
          padding: 2rem;
          border-radius: 12px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
          max-width: 1100px;
          width: 100%;
        }

        h1 {
          color: #2196f3;
          margin-bottom: .2rem;
        }

        #subinfo {
          color: #aaa;
          font-size: .95rem;
          margin-bottom: 1.8rem;
        }

        /* Cards */
        .dashboard-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
          gap: 1.5rem;
        }

        .card {
          background-color: #3c3c4c;
          padding: 1.5rem;
          border-radius: 12px;
          display: flex;
          align-items: center;
          gap: 1rem;
          transition: .25s ease;
          cursor: pointer;
        }

        .card:hover {
          transform: translateY(-4px);
          box-shadow: 0 0 14px rgba(33,150,243,.3);
        }

        .card-icon {
          background-color: #2196f3;
          padding: 0.7rem;
          border-radius: 10px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .card-icon i {
          color: white;
        }

        .card h3 {
          margin: 0;
          font-size: 1.2rem;
          color: #fff;
        }

        .card p {
          margin: .2rem 0 0 0;
          font-size: .9rem;
          color: #bbb;
        }

        /* Se√ß√£o admin */
        #adminMetrics {
          margin-top: 2.5rem;
          padding-top: 1.5rem;
          border-top: 1px solid #444;
        }

        .metric-box {
          background: #353545;
          padding: 1.2rem;
          border-radius: 10px;
          text-align: center;
          border-left: 4px solid #2196f3;
        }

        .metric-box h2 {
          margin: 0;
          font-size: 2rem;
          color: #2196f3;
        }

        .metric-box span {
          font-size: .9rem;
          color: #ddd;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<div id="navbar"></div>

<!-- CONTE√öDO -->
<main>
    <div class="container">

        <h1>Ol√°, <span id="nomeUsuario"></span> üëã</h1>
        <p id="subinfo"></p>

        <div class="dashboard-grid">
            <div onclick="location.href='/chamados.html'" class="card">
                <div class="card-icon"><i data-feather="file-text"></i></div>
                <div>
                    <h3>Meus Chamados</h3>
                    <p>Crie e visualize seus chamados</p>
                </div>
            </div>

            <div onclick="location.href='/perfil.html'" class="card">
                <div class="card-icon"><i data-feather="user"></i></div>
                <div>
                    <h3>Meu Perfil</h3>
                    <p>Gerencie suas informa√ß√µes pessoais</p>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o exclusiva para ADMIN -->
        <div id="adminMetrics" style="display:none;">
            <h2 style="margin-bottom:1rem;color:#2196f3;">Vis√£o Geral do Sistema</h2>

            <div class="dashboard-grid">
                <div class="metric-box">
                    <h2 id="mAbertos">0</h2>
                    <span>Abertos</span>
                </div>

                <div class="metric-box">
                    <h2 id="mAndamento">0</h2>
                    <span>Em Andamento</span>
                </div>

                <div class="metric-box">
                    <h2 id="mResolvidos">0</h2>
                    <span>Resolvidos</span>
                </div>

                <div class="metric-box">
                    <h2 id="mFechados">0</h2>
                    <span>Fechados</span>
                </div>
            </div>
        </div>

    </div>
</main>

<div id="footer"></div>

<script src="/script/includes.js"></script>
<script src="https://unpkg.com/feather-icons"></script>
<script> feather.replace(); </script>

<script>
    const usuario = JSON.parse(localStorage.getItem("usuario"));
    if (!usuario) location.href = "/login.html";

    document.getElementById("nomeUsuario").textContent = usuario.nome;
    document.getElementById("subinfo").textContent =
      "Voc√™ est√° logado como: " + usuario.nivel;

    // ADMIN => mostrar m√©tricas
    if (usuario.nivel === "ADMIN") {
        document.getElementById("adminMetrics").style.display = "block";
        carregarMetricas();
    }

    async function carregarMetricas() {
        const res = await fetch("/api/chamados");
        const dados = await res.json();

        document.getElementById("mAbertos").textContent =
            dados.filter(c => c.status === "ABERTO").length;

        document.getElementById("mAndamento").textContent =
            dados.filter(c => c.status === "EM_ANDAMENTO").length;

        document.getElementById("mResolvidos").textContent =
            dados.filter(c => c.status === "RESOLVIDO").length;

        document.getElementById("mFechados").textContent =
            dados.filter(c => c.status === "FECHADO").length;
    }
</script>

</body>
</html>
